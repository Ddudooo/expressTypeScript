<!DOCTYPE html>
<html>
    <head>
        <title>EXPRESS ADMIN TEST</title>
        <style>
            .paging{
                text-align: center;
                margin-top: 20px;
            }
            .page_btn{
                display: inline-block;
                border : 1px solid #333;
                padding : 2px 3px;
                cursor: pointer;
            }
        </style>
        <script src="/js/jquery-3.4.1.min.js"></script>
        <script>
                $().ready(function(){
                    var loginLogFrm = $('#loginLogFrm');
                    $('.page_btn').on("click", function(){
                        console.log(this);
                        console.log($(this).hasClass('next_page'));
                        if($(this).hasClass('next_page')){
                            loginLogFrm.append("<input type='hidden' name='offset' value='"+"<%=page*10+1%>"+"'/>");
                            //loginLogFrm.append("<input type='hidden' name='page' value='"+"<%=(page+1)%>"+"'/>");
                            $('#listPage').val("<%=(page+1)%>");
                        }else if($(this).hasClass('previous_page')){
                            loginLogFrm.append("<input type='hidden' name='offset' value='"+"<%=(page-1)*10%>"+"'/>");
                            //loginLogFrm.append("<input type='hidden' name='page' value='"+"<%=page-1%>"+"'/>");
                            $('#listPage').val("<%=(page+1)%>");
                        }else if($(this).hasClass("first_page")){
                            loginLogFrm.append("<input type='hidden' name='offset' value='1'/>");
                            $('#listPage').val("1");
                        }else if($(this).hasClass("last_page")){
                            loginLogFrm.append("<input type='hidden' name='offset' value='"+"<%=Math.floor((max/limit)+1)%>"+"'/>");
                            $('#listPage').val("<%=Math.floor(((max/limit)+1)/10+1)%>");
                        }else{
                            loginLogFrm.append("<input type='hidden' name='offset' value='"+this.innerHTML+"'/>");                        
                        }   
                        loginLogFrm.submit();                 
                    });
                    $('.listLimit').on("change",function(){
                        $('#listPage').val("1");
                        loginLogFrm.submit();
                    });
                })   
        </script>        
    </head>
    <body>
        <h1>INFORMATION</h1>
        <h2>LOGIN LOG LIST</h2>        
        <div>            
            <form id="loginLogFrm" method="POST">
                <div style="display:block;">
                    <%if(max >0){%><span> Total <%=max%> </span><%}%>
                    <span style="float: right;">
                        <select name="limit" class="listLimit">
                            <option value="10" <%=limit==10? 'selected':'' %>>10</option>
                            <option value="25" <%=limit==25? 'selected':'' %>>25</option>
                            <option value="50" <%=limit==50? 'selected':'' %>>50</option>
                            <option value="100" <%=limit==100? 'selected':'' %>>100</option>
                        </select>
                    </span>
                </div>
            <table style="width:100%;">
                <thead>
                    <tr>
                        <th>Member</th>
                        <th>IP</th>
                        <th>Request</th>
                        <th>Token Expired</th>
                        <th>Regdate</th>
                        <th>Changedate</th>
                    </tr>
                </thead>
                <tbody style="text-align: center;">
                    <!-- prettier-ignore-start -->
                    <% for (const log of logList) {%>                        
                    <tr style="<%=log.confirm?'':'background:#EE5555;font-weight:600;'%>">
                        <td><%=log.member?log.member.userId:"UNKNOWN"%></td>
                        <td>
                            <%let ip = log.ipaddress;%>
                            <%=ip.slice(0,ip.indexOf('.'))+'.*.*'+ip.slice(ip.lastIndexOf('.'))%>
                        </td>
                        <td><%=log.reqURI%></td>                        
                        <td>
                            <!-- prettier-ignore -->
                            <%if(log.token){%>
                            <%=log.token.block?"LOGOUT":moment(log.token.expired).format("YYYY-MM-DD HH:mm:ss")%>
                            <%}%>                            
                        </td>
                        <td>
                            <!-- prettier-ignore -->
                            <%=moment(log.regDate).format("YYYY-MM-DD HH:mm:ss")%>
                        </td>
                        <td>
                            <!-- prettier-ignore -->
                            <%=moment(log.changeDate).format("YYYY-MM-DD HH:mm:ss") %>
                        </td>
                    </tr>
                    <%} %>                   
                    <!-- prettier-ignore-end -->
                </tbody>                
            </table>
            <div class="paging">
            <%if(page>1) {%>
                <span class="page_btn first_page"><<</span>
                <span class="page_btn previous_page"><</span>                
            <%}%>
            <%for(let i = (page-1)*10*limit; i< max; i=i+Number(limit)){%>                
                <span class="<%=offset==(i/limit)?'active_page':'page_btn'%>"><%=(i/limit)+1%></span>
                <%if((i/limit)+1 >=page*10) {%>
                <span class="page_btn next_page">></span>
                <span class="page_btn last_page">>></span>
                <%break%>
                <%}%>
            <%}%>
            </div>
            <input type="hidden" name="page" id="listPage" value="<%=page%>"/>
            </form>
        </div>
    </body>
</html>
