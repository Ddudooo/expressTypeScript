<!DOCTYPE html>
<html>
    <head>
        <title>TEST PAGE</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                background: #333;
                color: #eee;
                font: 13px Helvetica, Arial;
            }
            form {
                background: transparent;
                padding: 3px;
                position: fixed;
                bottom: 0;
                width: 100%;
            }
            form input {
                border: 0;
                padding: 10px;
                width: 90%;
                margin-right: 0.5%;
            }
            form button {
                width: 9%;
                background: orange;
                border: none;
                border-radius: 3px;
                padding: 10px;
            }
            #messages {
                background: #333;
                color: #efefef;
                list-style-type: none;
                margin: 0;
                padding: 0;
            }
            #messages li {
                padding: 5px 10px;
            }
            #messages li:last-child {
                background: #555;
            }
        </style>
    </head>
    <body>
        <h1>TEST WEBSOCKET</h1>
        <h2>test</h2>
        <div>
            <ul id="messages"></ul>
            <form onsubmit="sendMsg(); return false;">
                <input type="text" id="msg" /><button type="submit">SEND</button>
            </form>
            <script src="/socket.io/socket.io.js"></script>
            <script>
                var socket = io("http://localhost:5000");
                var msgList = document.getElementById("messages");
                socket.on("news", function(data) {
                    console.log(data);
                    socket.emit("my other event", { my: "data" });
                });
                socket.on("send msg", function(data) {
                    addMsg(data);
                });
                socket.on("disconnect", function(reason) {
                    console.log(reason);
                    addMsg("Connection disconnect...");
                });
                function sendMsg() {
                    var msg = document.getElementById("msg").value;
                    if (msg.search("/") == 0) {
                        if (msg.search("change name") == 1) {
                            msg = msg.substring("/change name".length);
                            changeName(msg);
                        }
                        if (msg.search("joinRoom") == 1) {
                            msg = msg.substring("/joinRoom".length);
                            joinRoom(msg);
                        }
                        if (msg.search("clear") == 1) {
                            while (msgList.firstChild) {
                                msgList.removeChild(msgList.firstChild);
                            }
                        }
                    } else {
                        console.log("SEND MSG " + msg);
                        socket.emit("send msg", { msg: msg });
                    }
                    document.getElementById("msg").value = "";
                }
                function addMsg(data) {
                    var newMsg = document.createElement("LI");
                    var newMsgText = document.createTextNode(data.sender + " > " + data.msg);
                    newMsg.appendChild(newMsgText);
                    msgList.appendChild(newMsg);
                }
                function changeName(name) {
                    socket.emit("change name", { id: name });
                }
                function joinRoom(room) {
                    socket.emit("join Room", { room: room });
                }
            </script>
        </div>
    </body>
</html>
